<div [ngClass]="containerClasses()">
  <!-- Label -->
  @if (label()) {
    <label class="ds-select__label" [attr.for]="name()">
      {{ label() }}
      @if (required()) {
        <span class="ds-select__required">*</span>
      }
    </label>
  }

  <!-- Trigger -->
  <button
    #selectTrigger
    type="button"
    [ngClass]="triggerClasses()"
    [disabled]="isDisabled()"
    [attr.aria-expanded]="isOpen()"
    [attr.aria-haspopup]="'listbox'"
    [attr.aria-controls]="listboxId()"
    [attr.aria-label]="label() || placeholder()"
    (click)="toggle()">
    <span class="ds-select__value">{{ displayValue() }}</span>

    <span class="ds-select__icons">
      @if (clearable() && selectedOption()) {
        <button
          type="button"
          class="ds-select__clear"
          aria-label="Effacer la sélection"
          (click)="clear($event)">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      }
      <svg
        class="ds-select__arrow"
        [class.ds-select__arrow--open]="isOpen()"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </span>
  </button>

  <!-- Dropdown -->
  @if (isOpen()) {
    <div class="ds-select__dropdown" role="presentation">
      <!-- Search -->
      @if (searchable()) {
        <div class="ds-select__search">
          <input
            #searchInput
            type="text"
            class="ds-select__search-input"
            placeholder="Rechercher..."
            [value]="searchQuery()"
            (input)="onSearchInput($event)"
            aria-label="Rechercher une option" />
        </div>
      }

      <!-- Options list -->
      <ul
        #listbox
        [id]="listboxId()"
        class="ds-select__listbox"
        role="listbox"
        [attr.aria-label]="label() || 'Options'">
        @for (option of filteredOptions(); track option.value; let i = $index) {
          <li
            [id]="getOptionId(i)"
            class="ds-select__option"
            [class.ds-select__option--focused]="isOptionFocused(i)"
            [class.ds-select__option--selected]="isOptionSelected(option)"
            [class.ds-select__option--disabled]="option.disabled"
            role="option"
            [attr.aria-selected]="isOptionSelected(option)"
            [attr.aria-disabled]="option.disabled"
            (click)="selectOption(option)">
            <span class="ds-select__option-label">{{ option.label }}</span>
            @if (isOptionSelected(option)) {
              <svg
                class="ds-select__check"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            }
          </li>
        } @empty {
          <li class="ds-select__empty" role="option" aria-disabled="true">
            Aucun résultat
          </li>
        }
      </ul>
    </div>
  }

  <!-- Helper / Error -->
  @if (error()) {
    <span class="ds-select__error" role="alert">{{ error() }}</span>
  } @else if (helper()) {
    <span class="ds-select__helper">{{ helper() }}</span>
  }
</div>
