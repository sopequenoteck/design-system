<div
  [ngClass]="containerClasses()"
  (dragenter)="onDragEnter($event)"
  (dragover)="onDragOver($event)"
  (dragleave)="onDragLeave($event)"
  (drop)="onDrop($event)"
>
  <!-- Zone de drop -->
  <div
    class="ds-file-upload__dropzone"
    [class.ds-file-upload__dropzone--active]="isDragging()"
    (click)="openFileSelector()"
    [attr.tabindex]="disabled() ? null : 0"
    [attr.aria-label]="label()"
    role="button"
  >
    <input
      #fileInput
      type="file"
      class="ds-file-upload__input"
      [accept]="accept()"
      [multiple]="multiple()"
      [disabled]="disabled() || isMaxFilesReached()"
      (change)="onFileSelect($event)"
      aria-hidden="true"
      tabindex="-1"
    />

    <!-- Icône et texte -->
    <div class="ds-file-upload__icon">
      <fa-icon [icon]="faCloudArrowUp" size="2x"></fa-icon>
    </div>
    <div class="ds-file-upload__text">
      <span class="ds-file-upload__label">{{ label() }}</span>
      @if (!disabled() && !isMaxFilesReached()) {
        <span class="ds-file-upload__help">{{ dragHelpText() }}</span>
      }
      @if (isMaxFilesReached()) {
        <span class="ds-file-upload__limit">Limite atteinte ({{ maxFiles() }} fichier{{ maxFiles() > 1 ? 's' : '' }})</span>
      }
    </div>

    <!-- Message d'erreur global -->
    @if (errorMessage()) {
      <div class="ds-file-upload__error" role="alert">
        {{ errorMessage() }}
      </div>
    }

    <!-- Indications -->
    @if (!errorMessage() && accept() !== '*') {
      <div class="ds-file-upload__hint">
        Types acceptés : {{ accept() }}
      </div>
    }
    @if (!errorMessage() && maxFileSize()) {
      <div class="ds-file-upload__hint">
        Taille max : {{ formatFileSize(maxFileSize()) }}
      </div>
    }
  </div>

  <!-- Liste des fichiers -->
  @if (fileCount() > 0) {
    <div class="ds-file-upload__files">
      @for (uploadFile of files(); track uploadFile.file.name) {
        <div class="ds-file-upload__file">
          <!-- Preview image -->
          @if (showPreview() && uploadFile.preview) {
            <div class="ds-file-upload__preview">
              <img [src]="uploadFile.preview" [alt]="uploadFile.file.name" />
            </div>
          } @else {
            <div class="ds-file-upload__file-icon">
              <fa-icon [icon]="getFileIcon(uploadFile.file)"></fa-icon>
            </div>
          }

          <!-- Infos fichier -->
          <div class="ds-file-upload__file-info">
            <div class="ds-file-upload__file-name" [title]="uploadFile.file.name">
              {{ uploadFile.file.name }}
            </div>
            <div class="ds-file-upload__file-size">
              {{ formatFileSize(uploadFile.file.size) }}
            </div>

            <!-- Barre de progression -->
            @if (uploadFile.progress < 100) {
              <ds-progress-bar
                [value]="uploadFile.progress"
                size="sm"
                variant="default"
                [showLabel]="true"
              ></ds-progress-bar>
            }

            <!-- Message d'erreur fichier -->
            @if (uploadFile.error) {
              <div class="ds-file-upload__file-error" role="alert">
                {{ uploadFile.error }}
              </div>
            }
          </div>

          <!-- Bouton supprimer -->
          <button
            type="button"
            class="ds-file-upload__remove"
            (click)="removeFile(uploadFile)"
            [disabled]="disabled()"
            [attr.aria-label]="'Supprimer ' + uploadFile.file.name"
          >
            <fa-icon [icon]="faXmark"></fa-icon>
          </button>
        </div>
      }
    </div>
  }
</div>
