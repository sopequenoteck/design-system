import { Meta } from '@storybook/blocks';

<Meta title="Audits/DsColorPicker" />

# Audit : DsColorPicker

**Date** : 2025-12-14
**Version** : v1.6.0
**Auditeur** : Claude Code (ds-auditor agent)

---

## Score global : 78/100

### Répartition des scores

| Catégorie | Score | Pondération | Détails |
|-----------|-------|-------------|---------|
| **Architecture** | 85/100 | 25% | Structure propre, patterns Angular modernes |
| **Accessibilité** | 62/100 | 30% | Gaps ARIA, navigation clavier incomplète |
| **Tokens/Theming** | 95/100 | 20% | Excellente utilisation des tokens |
| **Tests** | 65/100 | 15% | Couverture 50%, tests panel manquants |
| **Stories** | 92/100 | 10% | Documentation riche, 12 stories |

---

## Résumé exécutif

### Points forts

1. **Architecture modulaire** : Séparation claire entre trigger (DsColorPicker) et panel (DsColorPickerPanelComponent)
2. **ControlValueAccessor complet** : Intégration formulaires réactifs impeccable
3. **Conversions de couleurs robustes** : Support HEX/RGB/HSL avec alpha channel
4. **Tokens CSS complets** : 24 tokens sémantiques + 12 tokens thématiques
5. **Canvas interactif** : Spectre de couleurs avec curseur drag & drop
6. **localStorage** : Persistance des couleurs récentes
7. **Stories riches** : 12 stories avec Reactive Forms et Signals

### Points à améliorer (7 problèmes)

| Sévérité | Nombre | Catégories affectées |
|----------|--------|----------------------|
| CRITIQUE | 0 | - |
| MAJEUR | 3 | Accessibilité, Tests |
| MINEUR | 4 | Accessibilité, Code quality |

---

## Inventaire du composant

### Fichiers sources

| Fichier | Lignes | Rôle |
|---------|--------|------|
| `ds-color-picker.ts` | 432 | Composant principal (trigger + CVA) |
| `ds-color-picker.html` | 45 | Template trigger |
| `ds-color-picker.scss` | 204 | Styles trigger (tailles, états) |
| `color-picker-panel.component.ts` | 508 | Panel overlay avec canvas |
| `color-picker-panel.component.scss` | 259 | Styles panel (spectrum, sliders, presets) |
| `ds-color-picker.spec.ts` | 355 | Tests unitaires (46 tests) |
| `ds-color-picker.stories.ts` | 359 | Stories Storybook (12 stories) |

**Total** : 7 fichiers, ~2160 lignes

---

### Inputs (10)

| Nom | Type | Défaut | Description |
|-----|------|--------|-------------|
| `value` | `string` | `''` | Couleur courante (HEX, RGB, HSL) |
| `size` | `ColorPickerSize` | `'md'` | Taille (`sm`, `md`, `lg`) |
| `disabled` | `boolean` | `false` | État désactivé |
| `showAlpha` | `boolean` | `false` | Afficher slider alpha |
| `presetColors` | `string[]` | `[]` | Palette personnalisée (24 par défaut) |
| `format` | `ColorFormat` | `'hex'` | Format d'affichage (`hex`, `rgb`, `hsl`) |
| `placeholder` | `string` | `'Select color'` | Texte placeholder |
| `allowClear` | `boolean` | `true` | Bouton clear visible |
| `showRecentColors` | `boolean` | `true` | Afficher couleurs récentes |
| `maxRecentColors` | `number` | `8` | Nombre max de couleurs récentes |

### Outputs (1)

| Nom | Type | Description |
|-----|------|-------------|
| `colorChange` | `EventEmitter<string>` | Émis lors de la sélection |

### Signals internes (7)

| Nom | Type | Description |
|-----|------|-------------|
| `isOpen` | `signal<boolean>` | État ouverture panel |
| `internalValue` | `signal<string>` | Valeur interne sync |
| `isFocused` | `signal<boolean>` | État focus |
| `recentColors` | `signal<string[]>` | Historique couleurs |
| `containerClasses` | `computed<string>` | Classes CSS dynamiques |
| `displayValue` | `computed<string>` | Valeur formatée (HEX/RGB/HSL) |
| `previewColor` | `computed<string>` | Couleur preview (transparent si vide) |

### Panel Signals (7)

| Nom | Type | Description |
|-----|------|-------------|
| `hue` | `signal<number>` | Teinte 0-360 |
| `saturation` | `signal<number>` | Saturation 0-100 |
| `lightness` | `signal<number>` | Luminosité 0-100 |
| `alpha` | `signal<number>` | Opacité 0-1 |
| `cursorX` / `cursorY` | `signal<number \| null>` | Position curseur spectrum |
| `isDragging` | `signal<boolean>` | État drag canvas |
| `rgb` / `hexValue` / `currentColor` | `computed` | Conversions couleur |

---

## Analyse détaillée

### 1. Architecture (85/100)

**Points forts** :
- Séparation trigger/panel avec CDK Overlay
- Pattern standalone + signals + ControlValueAccessor
- Conversions de couleurs dans méthodes privées réutilisables
- ComponentPortal pour instanciation dynamique du panel
- localStorage pour persistance (avec gestion erreurs)

**Points d'amélioration** :
- **[MINEUR]** Panel properties publiques sans `@Input()` :
  ```typescript
  // Ligne 191-196 color-picker-panel.component.ts
  value = '';
  showAlpha = false;
  presetColors: string[] = [];
  // ... assignation directe depuis le parent (ligne 265-270 ds-color-picker.ts)
  ```
  **Impact** : Fonctionne mais non idiomatique Angular (pas de change detection automatique)
  **Suggestion** : Convertir en `input<>()` signals ou `@Input()` decorators

---

### 2. Accessibilité WCAG 2.1 AA (62/100)

#### ARIA (60/100)

**Conformités** :
- `role="dialog"` sur le panel (ligne 24 panel template)
- `aria-label` sur canvas, sliders, boutons presets
- `aria-label` dynamique preview : `'Color: ' + displayValue()` (ligne 7)

**Problèmes critiques** :

##### [MAJEUR] Absence de `aria-expanded` sur trigger
**Fichier** : `ds-color-picker.html:2`
```html
<div class="ds-color-picker__trigger" (click)="toggle()">
```
**Manque** : `[attr.aria-expanded]="isOpen()"` pour indiquer l'état du panel
**Impact** : Lecteurs d'écran ne savent pas si le panel est ouvert
**Suggestion** :
```html
<div
  class="ds-color-picker__trigger"
  (click)="toggle()"
  role="button"
  tabindex="0"
  [attr.aria-expanded]="isOpen()"
  aria-haspopup="dialog">
```

##### [MAJEUR] Input trigger non focusable au clavier
**Fichier** : `ds-color-picker.html:11-20`
```html
<input
  type="text"
  class="ds-color-picker__input"
  readonly
  (focus)="onFocus()"
  (blur)="onBlur()"
  [attr.aria-label]="placeholder()" />
```
**Problème** : Pas de `(keydown)` pour ouvrir le panel avec Enter/Space
**Impact** : Navigation clavier impossible (uniquement souris)
**Suggestion** :
```html
<input
  ...
  (keydown.enter)="open()"
  (keydown.space)="$event.preventDefault(); open()"
  (keydown.escape)="close()" />
```

##### [MINEUR] Panel sans focus trap
**Fichier** : `ds-color-picker.ts:254-259`
```typescript
this.overlayRef = this.overlay.create({
  positionStrategy,
  hasBackdrop: true,
  backdropClass: 'cdk-overlay-transparent-backdrop',
  scrollStrategy: this.overlay.scrollStrategies.reposition(),
});
```
**Manque** : CDK `FocusTrap` pour confiner le focus dans le panel
**Impact** : Tab permet de sortir du panel (mauvaise UX)
**Suggestion** :
```typescript
import { FocusTrapFactory } from '@angular/cdk/a11y';

constructor(
  private overlay: Overlay,
  private elementRef: ElementRef,
  private focusTrapFactory: FocusTrapFactory // Ajouter
) {}

private createOverlay(): void {
  // ... après attach
  const panelElement = this.overlayRef.overlayElement;
  const focusTrap = this.focusTrapFactory.create(panelElement);
  focusTrap.focusInitialElementWhenReady();
}
```

#### Navigation clavier (50/100)

**Conformités** :
- Focus visible sur sliders et boutons (`:focus-visible` ligne 115, 239 panel.scss)
- Range sliders natifs accessibles

**Problèmes** :

##### [MAJEUR] Canvas spectrum non accessible au clavier
**Fichier** : `color-picker-panel.component.ts:314-327`
```typescript
onSpectrumMouseDown(event: MouseEvent): void {
  this.isDragging.set(true);
  this.updateColorFromSpectrum(event);
}
```
**Problème** : Uniquement événements souris, pas de fallback clavier
**Impact** : Utilisateurs clavier ne peuvent pas sélectionner dans le spectrum
**Suggestion** : Ajouter navigation fléchée :
```typescript
onSpectrumKeydown(event: KeyboardEvent): void {
  const step = event.shiftKey ? 10 : 1;
  let { saturation, lightness } = this;

  switch (event.key) {
    case 'ArrowRight': saturation = Math.min(100, saturation + step); break;
    case 'ArrowLeft':  saturation = Math.max(0, saturation - step); break;
    case 'ArrowUp':    lightness = Math.min(100, lightness + step); break;
    case 'ArrowDown':  lightness = Math.max(0, lightness - step); break;
    default: return;
  }

  event.preventDefault();
  this.saturation.set(saturation);
  this.lightness.set(lightness);
  this.updateCursor();
}
```

##### [MINEUR] Pas de navigation Tab entre presets
**Fichier** : Panel template ligne 144-156
```html
@for (color of presetColors; track color) {
  <button
    type="button"
    class="ds-color-picker-panel__preset"
    ...>
```
**Problème** : Grille de 24 boutons = 24 tab stops (fastidieux)
**Suggestion** : Utiliser `roving tabindex` (1 seul tab stop, navigation avec flèches)

#### Contraste (90/100)

**Conformités** :
- Tokens thématiques avec contraste suffisant (light/dark)
- Preview avec border pour distinction sur fonds similaires (ligne 34 ds-color-picker.scss)

**Problème mineur** :
- **[MINEUR]** Checkmark blanc sur presets clairs (ligne 254 panel.scss) :
  ```scss
  color: white;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));
  ```
  **Suggestion** : Contraste dynamique basé sur luminosité couleur

---

### 3. Tokens et Theming (95/100)

**Excellence** :
- **24 tokens sémantiques** exposés dans `_tokens.scss` (ligne 528-552)
- **12 tokens thématiques** dans `_light.scss` et `_dark.scss`
- Fallbacks cohérents : `var(--colorpicker-bg, var(--background-main))`
- Pas de couleurs hardcodées sauf gradients spectrum (obligatoires)

**Détail des tokens** :

| Groupe | Tokens | Exemples |
|--------|--------|----------|
| **Sizing** | 12 | `--colorpicker-height-{sm,md,lg}`, `--colorpicker-preview-size-md` |
| **Spacing** | 5 | `--colorpicker-padding-lg`, `--colorpicker-gap`, `--colorpicker-panel-gap` |
| **Visual** | 7 | `--colorpicker-radius`, `--colorpicker-panel-shadow` |
| **Thématiques** | 12 | `--colorpicker-bg`, `--colorpicker-text`, `--colorpicker-focus-shadow` |

**Vérification thèmes** :

```scss
// _light.scss (lignes 916-932)
--colorpicker-bg: var(--background-main);
--colorpicker-border: var(--border-default);
--colorpicker-panel-bg: var(--background-main);

// _dark.scss (lignes 926-942)
--colorpicker-bg: var(--gray-800);
--colorpicker-border: var(--gray-700);
--colorpicker-panel-bg: var(--gray-800);
```

**Point mineur** :
- **[MINEUR]** Gradients spectrum hardcodés (lignes 57-66 panel.scss) :
  ```scss
  background: linear-gradient(
    to right,
    #ff0000 0%, #ffff00 16.66%, #00ff00 33.33%,
    #00ffff 50%, #0000ff 66.66%, #ff00ff 83.33%,
    #ff0000 100%
  );
  ```
  **Justification** : Acceptable car gradient de teinte physique (impossible avec tokens)

---

### 4. Tests (65/100)

**Statistiques** :
- **46 tests** dans `ds-color-picker.spec.ts`
- **Couverture** : 50.29% lines, 48.77% statements, 54.23% functions
- **Seuil projet** : ≥80% (non atteint)

**Couverture par zone** :

| Zone | Tests | Couverture estimée |
|------|-------|-------------------|
| DsColorPicker (trigger) | 46 | ~90% |
| Panel component | 0 | 0% |
| Conversions couleurs | 3 | ~30% |
| CVA | 4 | ~70% |

**Problèmes** :

##### [MAJEUR] Panel component non testé
**Fichier manquant** : `color-picker-panel.component.spec.ts`
**Impact** : 508 lignes (canvas, sliders, presets) sans tests
**Suggestion** : Créer suite de tests pour :
- Initialisation canvas + gradients
- Drag & drop sur spectrum
- Changement sliders hue/alpha
- Sélection presets
- Inputs manuels RGB/HSL
- Conversions couleurs internes

##### [MINEUR] Tests conversions incomplets
**Fichier** : `ds-color-picker.spec.ts:296-312`
```typescript
it('should convert hex to RGB', () => { /* 1 seul cas */ });
it('should parse RGB color', () => { /* 1 seul cas */ });
```
**Manque** : Tests edge cases :
- HEX avec alpha (`#ff0000ff`)
- RGB avec espaces (`rgb( 255 , 0 , 0 )`)
- Valeurs invalides (`#zzz`, `rgb(300,0,0)`)
- HSL parsing

##### [MINEUR] Tests DOM incomplets
**Fichier** : `ds-color-picker.spec.ts:314-354`
**Couverture** : Preview, input, boutons clear/picker
**Manque** :
- Test overlay création/destruction
- Test click backdrop ferme panel
- Test escape key ferme panel
- Test localStorage (mock)

---

### 5. Stories Storybook (92/100)

**Excellence** :
- **12 stories** documentant tous les cas d'usage
- **Controls** interactifs pour tous les inputs
- **Reactive Forms** integration (ligne 145-190)
- **Signals** integration (ligne 192-241)
- **Compositions** : Theme Showcase, Color Palette Builder

**Stories détaillées** :

| Story | Objectif | Contrôles |
|-------|----------|-----------|
| `Default` | État initial | Tous |
| `Sizes` | sm/md/lg | - |
| `Formats` | hex/rgb/hsl | - |
| `WithAlpha` | Alpha channel | showAlpha |
| `CustomPresets` | Palette custom | presetColors |
| `Disabled` | État désactivé | disabled |
| `WithoutClear` | Sans bouton clear | allowClear |
| `EmptyState` | Sans couleur | - |
| `WithReactiveForm` | Reactive Forms | FormControl |
| `WithSignals` | Signals pattern | [(ngModel)] |
| `ThemeShowcase` | 4 variations | - |
| `ColorPalette` | Builder 6 couleurs | - |

**Point mineur** :
- **[MINEUR]** Story "Playground" sans documentation inline :
  ```typescript
  export const Playground: Story = {
    args: { ... }, // Pas de `render()` avec template annoté
  };
  ```
  **Suggestion** : Ajouter commentaires JSDoc ou `parameters.docs.description`

---

## Problèmes détectés (détail)

### [MAJEUR] #1 - Panel non accessible au clavier

**Fichiers** :
- `ds-color-picker.html:2` (trigger sans aria-expanded)
- `color-picker-panel.component.ts:314` (canvas mouse-only)

**Description** :
1. Trigger ne s'ouvre pas avec Enter/Space
2. Canvas spectrum nécessite souris (pas de navigation flèches)
3. Panel sans focus trap

**Impact WCAG** :
- **2.1.1 Keyboard (Level A)** : Échec
- **4.1.2 Name, Role, Value (Level A)** : Échec

**Correction suggérée** :
```typescript
// ds-color-picker.html
<div
  class="ds-color-picker__trigger"
  role="button"
  tabindex="0"
  [attr.aria-expanded]="isOpen()"
  (click)="toggle()"
  (keydown.enter)="open()"
  (keydown.space)="$event.preventDefault(); open()">

// color-picker-panel.component.ts
<canvas
  #spectrumCanvas
  tabindex="0"
  role="slider"
  aria-label="Color spectrum"
  [attr.aria-valuetext]="currentColor()"
  (keydown)="onSpectrumKeydown($event)"
  (mousedown)="onSpectrumMouseDown($event)">
```

---

### [MAJEUR] #2 - Panel component sans tests

**Fichier manquant** : `color-picker-panel.component.spec.ts`

**Description** : 508 lignes de code complexe (canvas, conversions HSL/RGB) sans couverture

**Impact** : Régression potentielle non détectée sur :
- Rendu gradients canvas
- Calculs coordonnées curseur
- Conversions couleurs (12+ méthodes)
- Sync state panel ↔ parent

**Correction suggérée** : Créer suite de tests (objectif 80% couverture) :
```typescript
describe('DsColorPickerPanelComponent', () => {
  // Setup
  it('should render spectrum canvas with correct dimensions', () => {});
  it('should initialize from HEX value', () => {});

  // Interactions
  it('should update color on spectrum click', () => {});
  it('should drag cursor on spectrum', () => {});
  it('should change hue on slider input', () => {});
  it('should change alpha on slider input', () => {});

  // Conversions
  it('should convert HEX to RGB', () => {});
  it('should convert RGB to HSL', () => {});
  it('should convert HSL to RGB', () => {});
  it('should parse HEX with alpha', () => {});
  it('should parse RGBA string', () => {});

  // Edge cases
  it('should handle invalid HEX input', () => {});
  it('should clamp RGB values to 0-255', () => {});
  it('should handle saturation/lightness at edges', () => {});

  // Presets
  it('should emit colorSelected on preset click', () => {});
  it('should highlight selected preset', () => {});

  // Keyboard
  it('should navigate spectrum with arrow keys', () => {});
  it('should close panel on Escape', () => {});
});
```

---

### [MAJEUR] #3 - Absence de focus trap sur panel

**Fichier** : `ds-color-picker.ts:254-259`

**Description** : Panel CDK Overlay sans gestion Tab

**Impact** :
- Tab permet de sortir du panel (focus sur éléments derrière)
- Conflit avec `hasBackdrop: true` (comportement incohérent)

**Correction suggérée** :
```typescript
import { FocusTrapFactory, ConfigurableFocusTrap } from '@angular/cdk/a11y';

export class DsColorPicker implements ControlValueAccessor {
  private focusTrap?: ConfigurableFocusTrap;

  constructor(
    private overlay: Overlay,
    private elementRef: ElementRef,
    private focusTrapFactory: FocusTrapFactory
  ) {}

  private createOverlay(): void {
    // ... existing code

    const componentRef = this.overlayRef.attach(portal);

    // Activer focus trap
    const panelElement = this.overlayRef.overlayElement;
    this.focusTrap = this.focusTrapFactory.create(panelElement);
    this.focusTrap.focusInitialElementWhenReady();
  }

  private destroyOverlay(): void {
    this.focusTrap?.destroy();
    this.focusTrap = undefined;

    if (this.overlayRef) {
      this.overlayRef.dispose();
      this.overlayRef = null;
    }
  }
}
```

---

### [MINEUR] #4 - Panel properties non-reactive

**Fichier** : `color-picker-panel.component.ts:191-196`

**Description** :
```typescript
// Config (set by parent)
value = '';
showAlpha = false;
presetColors: string[] = [];
```
Assignation directe sans `@Input()` ni signals

**Impact** :
- Pas de change detection si parent modifie après création
- Pattern non-standard Angular

**Correction suggérée** :
```typescript
// Option 1: Signals
readonly value = input<string>('');
readonly showAlpha = input<boolean>(false);
readonly presetColors = input<string[]>([]);

// Option 2: Inputs classiques
@Input() value = '';
@Input() showAlpha = false;
@Input() presetColors: string[] = [];
```

---

### [MINEUR] #5 - localStorage sans gestion quota

**Fichier** : `ds-color-picker.ts:319-325`

**Description** :
```typescript
private saveRecentColors(colors: string[]): void {
  try {
    localStorage.setItem('ds-color-picker-recent', JSON.stringify(colors));
  } catch (e) {
    // Ignorer les erreurs de stockage
  }
}
```

**Problème** : Pas de gestion `QuotaExceededError`

**Impact** : En cas de quota dépassé, fail silencieux sans fallback

**Correction suggérée** :
```typescript
private saveRecentColors(colors: string[]): void {
  try {
    localStorage.setItem('ds-color-picker-recent', JSON.stringify(colors));
  } catch (e) {
    if (e instanceof DOMException && e.name === 'QuotaExceededError') {
      // Clear old data and retry
      localStorage.removeItem('ds-color-picker-recent');
      try {
        localStorage.setItem('ds-color-picker-recent', JSON.stringify(colors));
      } catch (retryError) {
        console.warn('ColorPicker: localStorage unavailable, recent colors disabled');
      }
    }
  }
}
```

---

### [MINEUR] #6 - Checkmark contraste insuffisant

**Fichier** : `color-picker-panel.component.scss:249-258`

**Description** :
```scss
.ds-color-picker-panel__preset-check {
  color: white;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));
}
```

**Problème** : Checkmark blanc sur preset jaune/blanc = contraste < 4.5:1

**Impact WCAG** : **1.4.3 Contrast (Level AA)** : Échec

**Correction suggérée** :
```typescript
// color-picker-panel.component.ts
readonly checkmarkColor = computed(() => {
  const rgb = this.rgb();
  const luminance = (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;
  return luminance > 0.5 ? '#000' : '#fff';
});

// Template
@if (color === value) {
  <fa-icon
    [icon]="checkIcon"
    [style.color]="checkmarkColor()"
    class="ds-color-picker-panel__preset-check">
  </fa-icon>
}
```

---

### [MINEUR] #7 - Presets grid non responsive

**Fichier** : `color-picker-panel.component.scss:197-202`

**Description** :
```scss
.ds-color-picker-panel__presets-grid {
  display: grid;
  grid-template-columns: repeat(8, 1fr); // Fixed 8 columns
  gap: var(--space-2);
}
```

**Problème** : Panel 300px width, presets 28px → 8 colonnes OK, mais pas responsive

**Impact** : Sur petits écrans (mobile), presets trop petits

**Correction suggérée** :
```scss
.ds-color-picker-panel__presets-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(28px, 1fr));
  gap: var(--space-2);
}
```

---

## Checklist accessibilité WCAG 2.1 AA

| Critère | Statut | Conformité | Notes |
|---------|--------|-----------|-------|
| **2.1.1 Keyboard** | ⚠️ Partiel | 60% | Trigger OK, canvas inaccessible |
| **2.1.2 No Keyboard Trap** | ❌ Échec | 0% | Panel sans focus trap |
| **2.4.3 Focus Order** | ✅ Conforme | 100% | Ordre logique trigger → panel |
| **2.4.7 Focus Visible** | ✅ Conforme | 100% | `:focus-visible` sur tous éléments |
| **4.1.2 Name, Role, Value** | ⚠️ Partiel | 70% | `aria-expanded` manquant |
| **4.1.3 Status Messages** | ✅ Conforme | 100% | `colorChange` output |
| **1.4.3 Contrast** | ⚠️ Partiel | 90% | Checkmark blanc problématique |
| **1.4.11 Non-text Contrast** | ✅ Conforme | 100% | Preview border 3:1 |

**Score global accessibilité** : 62/100

---

## Recommandations prioritaires

### Priorité 1 (Critical - Sprint actuel)

1. **Ajouter focus trap sur panel**
   - Fichier : `ds-color-picker.ts`
   - Ligne : 254-259
   - Effort : 1h
   - Import `FocusTrapFactory` + lifecycle destroy

2. **Rendre canvas accessible au clavier**
   - Fichier : `color-picker-panel.component.ts`
   - Ligne : 314-327
   - Effort : 2h
   - `(keydown)` handler + `tabindex="0"` + `role="slider"`

3. **Ajouter tests panel component**
   - Fichier : Nouveau `color-picker-panel.component.spec.ts`
   - Effort : 4h
   - Objectif : 80% couverture (conversions + interactions)

### Priorité 2 (High - Sprint suivant)

4. **Compléter ARIA sur trigger**
   - Fichier : `ds-color-picker.html`
   - Ligne : 2
   - Effort : 30min
   - `aria-expanded`, `role="button"`, `(keydown.enter)`

5. **Améliorer contraste checkmark**
   - Fichier : `color-picker-panel.component.ts`
   - Effort : 1h
   - Computed signal luminance + couleur dynamique

### Priorité 3 (Medium - Backlog)

6. **Convertir panel properties en signals**
   - Fichier : `color-picker-panel.component.ts`
   - Ligne : 191-196
   - Effort : 1h
   - Migration `value = ''` → `readonly value = input<string>('')`

7. **Ajouter roving tabindex sur presets**
   - Fichier : Panel template
   - Effort : 2h
   - CDK `FocusKeyManager` pour navigation flèches

---

## Métriques de qualité

### Complexité cyclomatique

| Méthode | Complexité | Seuil | État |
|---------|-----------|-------|------|
| `updateColorFromSpectrum()` | 2 | 10 | ✅ Bon |
| `hslToRGB()` | 5 | 10 | ✅ Bon |
| `rgbToHSL()` | 5 | 10 | ✅ Bon |
| `parseColor()` | 4 | 10 | ✅ Bon |
| `toRGB()` / `toHSL()` | 3 | 10 | ✅ Bon |

**Moyenne** : 3.8 (Excellent)

### Dette technique

| Type | Nombre | Effort total |
|------|--------|--------------|
| Accessibilité | 3 majeurs + 2 mineurs | ~6h |
| Tests | 1 majeur | ~4h |
| Code quality | 2 mineurs | ~2h |

**Total** : ~12h (1.5 jours dev)

---

## Conclusion

Le composant **DsColorPicker** est globalement de **bonne qualité** avec une architecture solide et une utilisation exemplaire des tokens CSS. Les principaux axes d'amélioration concernent :

1. **Accessibilité clavier** : Panel non navigable sans souris (impact fort)
2. **Couverture tests** : Panel component non testé (risque régression)
3. **Focus management** : Absence de focus trap (UX dégradée)

Avec les corrections prioritaires (estimées à 7h), le score passerait de **78/100** à **92/100**.

---

**Prochaines étapes** :
1. Créer issue GitHub pour chaque problème MAJEUR
2. Planifier corrections dans sprint actuel
3. Re-audit après corrections (objectif : score ≥90)
