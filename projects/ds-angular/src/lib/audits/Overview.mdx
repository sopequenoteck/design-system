import { Meta } from '@storybook/blocks';

<Meta title="Audits/Overview" />

# Audits Design System - Vue d'ensemble

**Dernière mise à jour** : 2025-12-14

---

## Tableau de bord des audits

| Composant | Score | Date | Architecture | A11y | Tokens | Tests | Stories | Statut |
|-----------|-------|------|--------------|------|--------|-------|---------|--------|
| [DsColorPicker](/docs/audits-dscolorpicker--docs) | **78/100** | 2025-12-14 | 85 | 62 | 95 | 65 | 92 | ⚠️ En cours |
| [DsTimePicker](/docs/audits-dstimepicker--docs) | **82/100** | 2025-12-14 | 88 | 75 | 92 | 78 | 89 | ✅ Bon |

---

## Statistiques globales

### Composants audités : 2/47 (4.3%)

| Catégorie | Moyenne | Min | Max | Objectif |
|-----------|---------|-----|-----|----------|
| **Score global** | 80/100 | 78 | 82 | ≥85 |
| Architecture | 86.5/100 | 85 | 88 | ≥80 |
| Accessibilité | 68.5/100 | 62 | 75 | ≥80 |
| Tokens/Theming | 93.5/100 | 92 | 95 | ≥90 |
| Tests | 71.5/100 | 65 | 78 | ≥80 |
| Stories | 90.5/100 | 89 | 92 | ≥85 |

### Problèmes détectés

| Sévérité | DsColorPicker | DsTimePicker | Total |
|----------|---------------|--------------|-------|
| CRITIQUE | 0 | 0 | **0** |
| MAJEUR | 3 | 2 | **5** |
| MINEUR | 4 | 3 | **7** |

**Dette technique totale** : ~19h (2.4 jours)

---

## Priorités par composant

### DsColorPicker (Score : 78/100)

**Effort correctif** : ~7h (Priorité 1) + ~5h (Priorités 2-3)

| Priorité | Problème | Catégorie | Effort |
|----------|----------|-----------|--------|
| 1 | Panel non accessible au clavier | Accessibilité | 2h |
| 1 | Panel component sans tests | Tests | 4h |
| 1 | Absence focus trap | Accessibilité | 1h |
| 2 | ARIA incomplet sur trigger | Accessibilité | 30m |
| 2 | Contraste checkmark | Accessibilité | 1h |
| 3 | Panel properties non-reactive | Code quality | 1h |
| 3 | Roving tabindex sur presets | Accessibilité | 2h |

**Score projeté après corrections P1** : 92/100

---

### DsTimePicker (Score : 82/100)

**Effort correctif** : ~4h (Priorité 1) + ~3h (Priorités 2-3)

| Priorité | Problème | Catégorie | Effort |
|----------|----------|-----------|--------|
| 1 | Navigation clavier incomplète | Accessibilité | 2h |
| 1 | Tests panel manquants | Tests | 2h |
| 2 | ARIA sur panel | Accessibilité | 1h |
| 3 | Format validation | Code quality | 2h |

**Score projeté après corrections P1** : 91/100

---

## Conformité WCAG 2.1 AA

### DsColorPicker

| Critère | Conformité | Impact |
|---------|-----------|--------|
| 2.1.1 Keyboard | ⚠️ 60% | Panel canvas souris uniquement |
| 2.1.2 No Keyboard Trap | ❌ 0% | Pas de focus trap |
| 2.4.3 Focus Order | ✅ 100% | - |
| 2.4.7 Focus Visible | ✅ 100% | - |
| 4.1.2 Name, Role, Value | ⚠️ 70% | `aria-expanded` manquant |
| 1.4.3 Contrast | ⚠️ 90% | Checkmark blanc problématique |

**Score A11y** : 62/100

---

### DsTimePicker

| Critère | Conformité | Impact |
|---------|-----------|--------|
| 2.1.1 Keyboard | ⚠️ 80% | Navigation heures/minutes OK, secondes manquant |
| 2.1.2 No Keyboard Trap | ✅ 100% | Focus trap implémenté |
| 2.4.3 Focus Order | ✅ 100% | - |
| 2.4.7 Focus Visible | ✅ 100% | - |
| 4.1.2 Name, Role, Value | ⚠️ 85% | `role="spinbutton"` manquant |
| 1.4.3 Contrast | ✅ 100% | - |

**Score A11y** : 75/100

---

## Couverture tests

| Composant | Statements | Branches | Functions | Lines | Objectif |
|-----------|-----------|----------|-----------|-------|----------|
| DsColorPicker | 48.77% | 37.86% | 54.23% | 50.29% | ≥80% |
| DsTimePicker | 76.12% | 68.45% | 81.20% | 78.03% | ≥80% |

**Moyenne** : 64.2% (objectif : 80%)

**Fichiers manquants** :
- `color-picker-panel.component.spec.ts` (0 tests)
- Tests e2e Playwright pour DsColorPicker

---

## Recommandations transversales

### Accessibilité (Priorité 1)

1. **Standardiser focus trap sur tous les overlays**
   - Composants : DsColorPicker, DsDatePicker, DsSelect, DsCombobox
   - Effort : ~6h (1h par composant × 6)
   - Pattern : CDK `FocusTrapFactory` + lifecycle destroy

2. **Ajouter navigation clavier sur tous les canvas/grids**
   - Composants : DsColorPicker, DsCalendar
   - Effort : ~4h
   - Pattern : `(keydown)` + ArrowUp/Down/Left/Right + Home/End

3. **Compléter attributs ARIA sur panels**
   - Composants : Tous avec CDK Overlay
   - Effort : ~8h
   - Attributs : `aria-expanded`, `role`, `aria-controls`, `aria-labelledby`

### Tests (Priorité 2)

1. **Créer tests pour tous les panel components**
   - Fichiers manquants : 5+ composants
   - Effort : ~20h
   - Objectif : 80% couverture globale

2. **Ajouter tests e2e Playwright**
   - Composants : DsColorPicker, DsDatePicker, DsSelect
   - Effort : ~12h (4h par composant)
   - Scénarios : Ouverture, navigation clavier, sélection, fermeture

### Code quality (Priorité 3)

1. **Uniformiser communication parent ↔ panel**
   - Pattern actuel : Properties publiques sans `@Input()`
   - Pattern cible : `input<>()` signals
   - Composants : DsColorPicker, DsTimePicker, DsDatePicker
   - Effort : ~3h

2. **Ajouter validation inputs manuels**
   - Composants : DsColorPicker (HEX), DsTimePicker (format)
   - Effort : ~4h
   - Pattern : Regex + visual feedback erreur

---

## Prochains audits planifiés

| Composant | Complexité | Priorité | Date cible |
|-----------|-----------|----------|------------|
| DsSelect | Haute | 1 | 2025-12-15 |
| DsCombobox | Haute | 1 | 2025-12-16 |
| DsDatePicker | Très haute | 1 | 2025-12-17 |
| DsTable | Très haute | 2 | 2025-12-18 |
| DsModal | Moyenne | 2 | 2025-12-19 |
| DsDropdown | Moyenne | 2 | 2025-12-20 |

**Objectif Q1 2026** : 20/47 composants audités (43%)

---

## Méthodologie d'audit

### Critères d'évaluation

1. **Architecture (25%)**
   - Séparation des responsabilités
   - Utilisation patterns Angular (signals, standalone, CVA)
   - Gestion state et lifecycle
   - Dépendances CDK

2. **Accessibilité WCAG 2.1 AA (30%)**
   - Navigation clavier complète
   - Attributs ARIA conformes
   - Focus management
   - Contraste couleurs
   - Lecteurs d'écran

3. **Tokens/Theming (20%)**
   - Utilisation CSS custom properties
   - Cohérence light/dark/custom
   - Absence couleurs hardcodées
   - Fallbacks

4. **Tests (15%)**
   - Couverture ≥80%
   - Tests unitaires + e2e
   - Edge cases
   - Mocks/Spies corrects

5. **Stories Storybook (10%)**
   - Documentation complète
   - Contrôles interactifs
   - Cas d'usage variés
   - Exemples Reactive Forms

### Barème de notation

| Score | Appréciation | Action |
|-------|-------------|--------|
| ≥90 | Excellent | Maintenance uniquement |
| 80-89 | Bon | Corrections mineures |
| 70-79 | Acceptable | Corrections prioritaires |
| 60-69 | Insuffisant | Refactoring requis |
| <60 | Critique | Réécriture envisagée |

---

## Ressources

- [Guide Accessibilité WCAG 2.1](https://www.w3.org/WAI/WCAG21/quickref/)
- [Angular CDK A11y](https://material.angular.io/cdk/a11y/overview)
- [ARIA Authoring Practices](https://www.w3.org/WAI/ARIA/apg/)
- [Testing Library Best Practices](https://testing-library.com/docs/guiding-principles/)

---

**Prochaine revue** : 2025-12-21 (après audits Select/Combobox/DatePicker)
