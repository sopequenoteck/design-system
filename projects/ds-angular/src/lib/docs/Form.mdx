{/* Form.mdx */}
import { Meta } from '@storybook/blocks';

<Meta title="Forms/Overview" />

# Composants de formulaire

Biblioth√®que compl√®te de composants pour la saisie et la s√©lection de donn√©es, avec support complet des Reactive Forms Angular.

---

## Quand utiliser quoi ?

Le choix du composant d√©pend du type de donn√©e √† collecter :

| Besoin | Composant recommand√© | Alternatives |
|--------|---------------------|--------------|
| **Texte court** (nom, email) | `DsInputField` | - |
| **Texte long** (description) | `DsInputTextarea` | - |
| **Recherche avec filtrage** | `DsSearchInput` | `DsCombobox` |
| **Choix unique (peu d'options)** | `DsRadioGroup` | `DsSegmentedControl` |
| **Choix unique (beaucoup d'options)** | `DsSelect` | `DsCombobox` |
| **Choix multiples** | `DsCheckbox` (groupe) | `DsCombobox` avec multi |
| **Valeur num√©rique** | `DsInputNumber` | `DsSlider` |
| **Valeur dans une plage** | `DsSlider` | `DsInputNumber` |
| **Oui/Non, On/Off** | `DsToggle` | `DsCheckbox` |
| **Date** | `DsDatePicker` | - |
| **Heure** | `DsTimePicker` | - |
| **Couleur** | `DsColorPicker` | - |
| **Fichier(s)** | `DsFileUpload` | - |

---

## Vue d'ensemble des composants

### Inputs texte

| Composant | Description | Cas d'usage |
|-----------|-------------|-------------|
| **DsInputField** | Champ de saisie avec label, helper, √©tats | Nom, email, mot de passe |
| **DsInputTextarea** | Zone de texte multi-lignes | Commentaires, descriptions |
| **DsSearchInput** | Champ avec debounce et ic√¥ne | Barres de recherche |
| **DsCombobox** | Autocomplete avec filtrage | S√©lection avec recherche |

### S√©lection

| Composant | Description | Cas d'usage |
|-----------|-------------|-------------|
| **DsCheckbox** | Case √† cocher avec label | Conditions, options multiples |
| **DsRadioGroup** | Groupe de boutons radio | Choix exclusif (2-5 options) |
| **DsToggle** | Interrupteur on/off | Param√®tres bool√©ens |
| **DsSelect** | Liste d√©roulante | Choix parmi une liste |
| **DsSlider** | Curseur de valeur | Volume, pourcentages |
| **DsSegmentedControl** | Boutons radio visuels | Vue grille/liste, filtres |

### Pickers

| Composant | Description | Cas d'usage |
|-----------|-------------|-------------|
| **DsDatePicker** | Calendrier de s√©lection | Dates de naissance, r√©servations |
| **DsTimePicker** | S√©lecteur d'heure | Horaires, rappels |
| **DsColorPicker** | Palette de couleurs | Personnalisation th√®me |

### Valeurs num√©riques

| Composant | Description | Cas d'usage |
|-----------|-------------|-------------|
| **DsInputNumber** | Input avec stepper +/- | Quantit√©s, √¢ge |
| **DsSlider** | Curseur sur une plage | Volume, prix max |

### Upload

| Composant | Description | Cas d'usage |
|-----------|-------------|-------------|
| **DsFileUpload** | Zone drag & drop | Documents, images |

---

## Patterns d'utilisation

### Formulaire avec Reactive Forms

Tous les composants impl√©mentent `ControlValueAccessor` pour une int√©gration native :

```typescript
import { Component } from '@angular/core';
import { FormGroup, FormControl, Validators, ReactiveFormsModule } from '@angular/forms';
import { DsInputField, DsSelect, DsCheckbox, DsButton } from '@kksdev/ds-angular';

@Component({
  standalone: true,
  imports: [ReactiveFormsModule, DsInputField, DsSelect, DsCheckbox, DsButton],
  template: `
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <ds-input-field
        formControlName="email"
        label="Email"
        type="email"
        [state]="getFieldState('email')"
        [errorText]="getFieldError('email')"
      />

      <ds-input-field
        formControlName="password"
        label="Mot de passe"
        type="password"
        [state]="getFieldState('password')"
        [errorText]="getFieldError('password')"
      />

      <ds-select
        formControlName="country"
        label="Pays"
        [options]="countries"
        placeholder="S√©lectionnez..."
      />

      <ds-checkbox formControlName="terms">
        J'accepte les conditions g√©n√©rales
      </ds-checkbox>

      <button ds-button
              variant="primary"
              type="submit"
              [disabled]="form.invalid || form.pending">
        S'inscrire
      </button>
    </form>
  `
})
export class RegistrationFormComponent {
  form = new FormGroup({
    email: new FormControl('', [Validators.required, Validators.email]),
    password: new FormControl('', [Validators.required, Validators.minLength(8)]),
    country: new FormControl('', Validators.required),
    terms: new FormControl(false, Validators.requiredTrue)
  });

  countries = [
    { value: 'fr', label: 'France' },
    { value: 'be', label: 'Belgique' },
    { value: 'ch', label: 'Suisse' }
  ];

  getFieldState(field: string): 'default' | 'error' | 'success' {
    const control = this.form.get(field);
    if (!control?.touched) return 'default';
    return control.invalid ? 'error' : 'success';
  }

  getFieldError(field: string): string {
    const control = this.form.get(field);
    if (!control?.errors) return '';

    if (control.errors['required']) return 'Ce champ est requis';
    if (control.errors['email']) return 'Email invalide';
    if (control.errors['minlength']) {
      return `Minimum ${control.errors['minlength'].requiredLength} caract√®res`;
    }
    return '';
  }

  onSubmit() {
    if (this.form.valid) {
      console.log(this.form.value);
    }
  }
}
```

### √âtats de validation

Les composants supportent 4 √©tats visuels :

```html
<!-- √âtat par d√©faut -->
<ds-input-field state="default" label="Nom" />

<!-- Succ√®s (validation pass√©e) -->
<ds-input-field state="success" label="Email" helper="Email valide" />

<!-- Avertissement -->
<ds-input-field state="warning" label="Mot de passe" helper="Mot de passe faible" />

<!-- Erreur -->
<ds-input-field state="error" label="T√©l√©phone" errorText="Format invalide" />
```

### Tailles disponibles

Tous les composants de formulaire supportent 3 tailles :

```html
<ds-input-field size="sm" label="Small" />
<ds-input-field size="md" label="Medium (d√©faut)" />
<ds-input-field size="lg" label="Large" />
```

### Groupe de champs avec validation

```typescript
@Component({
  template: `
    <div class="form-group">
      <ds-radio-group
        formControlName="paymentMethod"
        label="Mode de paiement"
        [options]="paymentOptions"
        [state]="form.get('paymentMethod')?.touched && form.get('paymentMethod')?.invalid ? 'error' : 'default'"
      />

      @if (form.get('paymentMethod')?.value === 'card') {
        <ds-input-field
          formControlName="cardNumber"
          label="Num√©ro de carte"
          placeholder="1234 5678 9012 3456"
          [state]="getFieldState('cardNumber')"
        />
      }
    </div>
  `
})
export class PaymentFormComponent {
  paymentOptions = [
    { value: 'card', label: 'Carte bancaire' },
    { value: 'paypal', label: 'PayPal' },
    { value: 'transfer', label: 'Virement' }
  ];
}
```

---

## Accessibilit√©

### Labels et descriptions

Tous les composants de formulaire associent automatiquement :

```html
<ds-input-field
  label="Adresse email"
  helper="Nous ne partagerons jamais votre email"
  required
/>
<!-- G√©n√®re automatiquement :
  - <label for="input-xxx">
  - aria-describedby pour le helper
  - aria-required="true"
-->
```

### √âtats d'erreur accessibles

```html
<ds-input-field
  state="error"
  errorText="Ce champ est requis"
/>
<!-- G√©n√®re automatiquement :
  - aria-invalid="true"
  - aria-describedby li√© au message d'erreur
  - role="alert" sur le message
-->
```

### Navigation clavier

| Touche | Action |
|--------|--------|
| `Tab` | Naviguer entre les champs |
| `Space` | Cocher/d√©cocher (checkbox, radio, toggle) |
| `Enter` | Valider la s√©lection, soumettre |
| `Escape` | Fermer les dropdowns |
| `‚Üë` `‚Üì` | Naviguer dans les options (select, radio) |
| `Home` `End` | Premi√®re/derni√®re option |

---

## Bonnes pratiques

### Organisation des formulaires

```html
<!-- ‚úÖ Bon : groupes logiques avec espacement -->
<form class="form">
  <fieldset>
    <legend>Informations personnelles</legend>
    <ds-input-field label="Pr√©nom" />
    <ds-input-field label="Nom" />
  </fieldset>

  <fieldset>
    <legend>Coordonn√©es</legend>
    <ds-input-field label="Email" type="email" />
    <ds-input-field label="T√©l√©phone" type="tel" />
  </fieldset>
</form>
```

### Messages d'erreur clairs

```typescript
// ‚úÖ Bon : messages d'erreur sp√©cifiques et actionnables
getFieldError(field: string): string {
  const errors = this.form.get(field)?.errors;
  if (!errors) return '';

  if (errors['required']) return 'Ce champ est obligatoire';
  if (errors['email']) return 'Entrez une adresse email valide (ex: nom@exemple.com)';
  if (errors['minlength']) return `Minimum ${errors['minlength'].requiredLength} caract√®res requis`;
  if (errors['pattern']) return 'Format invalide';
  return 'Valeur invalide';
}
```

### Validation en temps r√©el

```typescript
// ‚úÖ Bon : validation √† la saisie pour feedback imm√©diat
this.form.get('email')?.valueChanges.pipe(
  debounceTime(300),
  distinctUntilChanged()
).subscribe(value => {
  // Validation asynchrone (ex: email unique)
});
```

---

## Exemples complets

### Formulaire de contact

```typescript
@Component({
  template: `
    <form [formGroup]="contactForm" (ngSubmit)="onSubmit()">
      <ds-input-field
        formControlName="name"
        label="Nom complet"
        required
      />

      <ds-input-field
        formControlName="email"
        label="Email"
        type="email"
        required
      />

      <ds-select
        formControlName="subject"
        label="Sujet"
        [options]="subjects"
        required
      />

      <ds-input-textarea
        formControlName="message"
        label="Message"
        [rows]="5"
        required
      />

      <ds-checkbox formControlName="newsletter">
        Recevoir notre newsletter
      </ds-checkbox>

      <button ds-button variant="primary" type="submit">
        Envoyer
      </button>
    </form>
  `
})
export class ContactFormComponent {
  subjects = [
    { value: 'support', label: 'Support technique' },
    { value: 'sales', label: 'Question commerciale' },
    { value: 'feedback', label: 'Feedback' }
  ];

  contactForm = new FormGroup({
    name: new FormControl('', Validators.required),
    email: new FormControl('', [Validators.required, Validators.email]),
    subject: new FormControl('', Validators.required),
    message: new FormControl('', [Validators.required, Validators.minLength(10)]),
    newsletter: new FormControl(false)
  });

  onSubmit() {
    if (this.contactForm.valid) {
      console.log(this.contactForm.value);
    }
  }
}
```

### Formulaire de param√®tres

```typescript
@Component({
  template: `
    <form [formGroup]="settingsForm">
      <ds-segmented-control
        formControlName="theme"
        label="Th√®me"
        [options]="themeOptions"
      />

      <ds-slider
        formControlName="volume"
        label="Volume des notifications"
        [min]="0"
        [max]="100"
        [showTicks]="true"
        [step]="10"
      />

      <ds-toggle
        formControlName="notifications"
        label="Notifications push"
      />

      <ds-toggle
        formControlName="darkMode"
        label="Mode sombre"
      />

      <ds-color-picker
        formControlName="accentColor"
        label="Couleur d'accent"
        [presets]="colorPresets"
      />
    </form>
  `
})
export class SettingsFormComponent {
  themeOptions = [
    { value: 'light', label: 'Clair' },
    { value: 'dark', label: 'Sombre' },
    { value: 'auto', label: 'Auto' }
  ];

  colorPresets = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];

  settingsForm = new FormGroup({
    theme: new FormControl('light'),
    volume: new FormControl(50),
    notifications: new FormControl(true),
    darkMode: new FormControl(false),
    accentColor: new FormControl('#3b82f6')
  });
}
```

---

<div style={{
  padding: '24px',
  background: 'var(--background-secondary)',
  borderRadius: '12px',
  textAlign: 'center',
  marginTop: '32px'
}}>
  <div style={{ fontSize: '24px', marginBottom: '8px' }}>üìù</div>
  <strong>13 composants de formulaire</strong>
  <p style={{ margin: '8px 0 0', fontSize: '14px', color: 'var(--text-muted)' }}>
    Tous compatibles avec Angular Reactive Forms et accessibles WCAG 2.1 AA.
  </p>
</div>
