{/* Feedback.mdx */}
import { Meta } from '@storybook/blocks';

<Meta title="Feedback/Overview" />

# Feedback

Composants pour les notifications et retours utilisateur.

---

## Vue d'ensemble

La cat√©gorie **Feedback** regroupe les composants qui communiquent des informations √† l'utilisateur.

| Composant | Description |
|-----------|-------------|
| **DsAlert** | Message contextuel (success, warning, error, info) |
| **DsToast** | Notification temporaire |
| **DsNotification** | Notifications riches avec actions et positionnement |
| **DsEmpty** | √âtat vide avec illustration |
| **DsTooltip** | Info-bulle au survol |

---

## Patterns d'utilisation

### Alertes contextuelles

```html
<!-- Alert de succ√®s -->
<ds-alert type="success" [closable]="true">
  Op√©ration r√©ussie !
</ds-alert>

<!-- Alert d'erreur -->
<ds-alert type="error" [showIcon]="true">
  Une erreur s'est produite. Veuillez r√©essayer.
</ds-alert>

<!-- Alert d'information -->
<ds-alert type="info">
  Nouvelle fonctionnalit√© disponible.
</ds-alert>
```

### Notifications toast

```typescript
// Dans le composant
constructor(private toastService: DsToastService) {}

showToast() {
  this.toastService.show({
    message: 'Modifications enregistr√©es',
    type: 'success',
    duration: 3000,
    position: 'top-right'
  });
}
```

```html
<!-- Placement du container -->
<ds-toast-container position="top-right" />
```

### √âtat vide

```html
<ds-empty
  variant="icon"
  title="Aucun r√©sultat"
  description="Essayez de modifier vos crit√®res de recherche"
>
  <button ds-button variant="primary">
    R√©initialiser les filtres
  </button>
</ds-empty>
```

### Tooltips

```html
<!-- Sur un √©l√©ment -->
<button dsTooltip="Supprimer l'√©l√©ment" position="top">
  <fa-icon [icon]="faTrash" />
</button>

<!-- Avec d√©lai -->
<span dsTooltip="Aide contextuelle" [delay]="500">
  Besoin d'aide ?
</span>
```

---

## Types de feedback

### S√©mantique des types

| Type | Usage | Couleur |
|------|-------|---------|
| **success** | Confirmation d'action r√©ussie | Vert |
| **warning** | Avertissement, action requise | Orange |
| **error** | Erreur, action bloqu√©e | Rouge |
| **info** | Information contextuelle | Bleu |

### Dur√©e des toasts

```typescript
// Court (action simple)
{ duration: 2000 }

// Standard
{ duration: 3000 }

// Long (message important)
{ duration: 5000 }

// Permanent (action requise)
{ duration: 0, closable: true }
```

### Positions

```typescript
type ToastPosition =
  | 'top-left'
  | 'top-center'
  | 'top-right'
  | 'bottom-left'
  | 'bottom-center'
  | 'bottom-right';
```

---

## Accessibilit√©

### ARIA Live Regions

```html
<!-- Alertes -->
<div role="alert" aria-live="polite">
  Message d'information
</div>

<!-- Erreurs urgentes -->
<div role="alert" aria-live="assertive">
  Erreur critique !
</div>
```

### Toasts

- Les toasts utilisent `aria-live="polite"` par d√©faut
- Les erreurs utilisent `aria-live="assertive"`
- Focus pi√©g√© si le toast requiert une action

### Tooltips

```html
<button aria-describedby="tooltip-1">
  Action
</button>
<div id="tooltip-1" role="tooltip">
  Description de l'action
</div>
```

### Bonnes pratiques

1. **Ne pas abuser des toasts** - R√©server aux confirmations importantes
2. **Alertes fermables** - Permettre √† l'utilisateur de les masquer
3. **Messages clairs** - Indiquer ce qui s'est pass√© et quoi faire
4. **Contraste suffisant** - Respecter WCAG AA (4.5:1)

---

## DsAlert

Banni√®re de feedback pour afficher des messages de succ√®s, avertissement, erreur ou information.

### Inputs

| Nom | Type | D√©faut | Description |
|-----|------|--------|-------------|
| `type` | `AlertType` | `'info'` | Type de feedback |
| `size` | `AlertSize` | `'md'` | Taille de l'alerte |
| `showIcon` | `boolean` | `true` | Affiche une ic√¥ne selon le type |
| `closable` | `boolean` | `false` | Permet de fermer l'alerte |
| `hidden` | `boolean` | `false` | Masque l'alerte |

### Outputs

| Nom | Type | Description |
|-----|------|-------------|
| `closed` | `void` | √âmis lors de la fermeture |

### Types

```typescript
type AlertType = 'success' | 'warning' | 'error' | 'info';
type AlertSize = 'sm' | 'md' | 'lg';
```

### Exemples

```html
<!-- Alerte success -->
<ds-alert type="success">
  Votre op√©ration a √©t√© effectu√©e avec succ√®s !
</ds-alert>

<!-- Alerte error fermable -->
<ds-alert type="error" [closable]="true" (closed)="onClose()">
  Une erreur est survenue. Veuillez r√©essayer.
</ds-alert>

<!-- Alerte warning sans ic√¥ne -->
<ds-alert type="warning" [showIcon]="false">
  Attention : cette action est irr√©versible.
</ds-alert>

<!-- Alerte info petite -->
<ds-alert type="info" size="sm">
  Nouvelle fonctionnalit√© disponible.
</ds-alert>
```

---

## DsToast

Service de notifications temporaires avec positionnement et actions configurables.

### Service DsToastService

#### M√©thodes

| M√©thode | Signature | Description |
|---------|-----------|-------------|
| `show()` | `(options: ToastOptions) => string` | Affiche un toast |
| `dismiss()` | `(id: string) => void` | Ferme un toast par ID |
| `clear()` | `(position?: ToastPosition) => void` | Ferme tous les toasts |
| `triggerAction()` | `(id: string) => void` | D√©clenche l'action du toast |

### Types

```typescript
type ToastType = 'success' | 'warning' | 'error' | 'info';
type ToastPosition = 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';

interface ToastOptions {
  message: string;
  type?: ToastType;           // default: 'info'
  duration?: number;          // default: 3000 (0 = permanent)
  closable?: boolean;         // default: true
  position?: ToastPosition;   // default: 'top-right'
  actionLabel?: string;
  onAction?: () => void;
  pauseOnHover?: boolean;     // default: true
  maxStack?: number;          // default: 4
}

interface ToastInstance {
  id: string;
  message: string;
  type: ToastType;
  duration: number;
  closable: boolean;
  position: ToastPosition;
  actionLabel?: string;
  onAction?: () => void;
  pauseOnHover: boolean;
}
```

### Exemples

```html
<!-- Container √† placer une fois dans l'app (id√©alement dans AppComponent) -->
<ds-toast-container />
```

```typescript
// Injection du service
constructor(private toastService: DsToastService) {}

// Toast simple
showSuccess() {
  this.toastService.show({
    message: 'Modifications enregistr√©es',
    type: 'success'
  });
}

// Toast avec action
showWithAction() {
  this.toastService.show({
    message: 'Fichier supprim√©',
    type: 'info',
    actionLabel: 'Annuler',
    onAction: () => this.undoDelete()
  });
}

// Toast permanent
showPermanent() {
  this.toastService.show({
    message: 'Connexion perdue',
    type: 'error',
    duration: 0,
    closable: true
  });
}

// Toast avec position personnalis√©e
showBottomLeft() {
  this.toastService.show({
    message: 'Notification',
    position: 'bottom-left'
  });
}
```

---

## DsNotification

Syst√®me de notifications riches avec service injectable, support des actions, positionnement configurable et stack management.

### Service DsNotificationService

Le service est providedIn: 'root', disponible globalement.

#### M√©thodes

| M√©thode | Signature | Description |
|---------|-----------|-------------|
| `open()` | `(config: NotificationConfig) => string` | Ouvre une notification avec configuration compl√®te |
| `info()` | `(title: string, message: string, config?) => string` | Notification de type info |
| `success()` | `(title: string, message: string, config?) => string` | Notification de type success |
| `warning()` | `(title: string, message: string, config?) => string` | Notification de type warning |
| `error()` | `(title: string, message: string, config?) => string` | Notification de type error |
| `close()` | `(id: string) => void` | Ferme une notification par ID |
| `closeAll()` | `() => void` | Ferme toutes les notifications |

### DsNotificationContainerComponent

#### Inputs

| Nom | Type | D√©faut | Description |
|-----|------|--------|-------------|
| `placement` | `NotificationPlacement` | `'topRight'` | Position du container |
| `maxStack` | `number` | `5` | Nombre max de notifications visibles |

### Types

```typescript
interface NotificationConfig {
  id?: string;
  title: string;
  message: string;
  type?: 'info' | 'success' | 'warning' | 'error';
  duration?: number;        // 0 = persistent, default 4500ms
  closable?: boolean;
  icon?: IconDefinition;
  actions?: NotificationAction[];
}

interface NotificationAction {
  label: string;
  handler: () => void;
  variant?: 'primary' | 'secondary' | 'ghost';
}

type NotificationPlacement = 'topRight' | 'topLeft' | 'bottomRight' | 'bottomLeft';

interface NotificationItem extends NotificationConfig {
  id: string;
  timestamp: number;
}
```

### Exemples

```html
<!-- Container √† placer une fois dans l'app -->
<ds-notification-container [placement]="'topRight'" [maxStack]="5" />
```

```typescript
// Injection du service
constructor(private notificationService: DsNotificationService) {}

// Notifications simples
openInfo() {
  this.notificationService.info('Information', 'Ceci est une notification informative.');
}

openSuccess() {
  this.notificationService.success('Succ√®s', 'Op√©ration effectu√©e avec succ√®s !');
}

openWarning() {
  this.notificationService.warning('Attention', 'Cette action n√©cessite votre attention.');
}

openError() {
  this.notificationService.error('Erreur', 'Une erreur est survenue.');
}

// Notification avec actions
openWithActions() {
  this.notificationService.open({
    title: 'Confirmation requise',
    message: 'Voulez-vous vraiment effectuer cette action ?',
    type: 'warning',
    duration: 0,
    actions: [
      {
        label: 'Confirmer',
        variant: 'primary',
        handler: () => console.log('Confirmed')
      },
      {
        label: 'Annuler',
        variant: 'ghost',
        handler: () => console.log('Cancelled')
      }
    ]
  });
}

// Notification persistante
openPersistent() {
  this.notificationService.open({
    title: 'Notification persistante',
    message: 'Ne se ferme pas automatiquement.',
    type: 'info',
    duration: 0
  });
}
```

### Accessibilit√©

| Attribut | Description |
|----------|-------------|
| `role="alert"` | Identifie la notification |
| `aria-live="polite"` | Annonce au lecteur d'√©cran |
| Bouton fermeture | Accessible au clavier |

### Stories disponibles

Default, TopLeft, BottomRight, BottomLeft, LimitedStack, AllTypes, WithActions, PersistentNotification, AutoDismiss, NotClosable, MultipleActions, RealWorldExample

---

## DsTooltip

Directive pour afficher une info-bulle au survol ou focus d'un √©l√©ment.

### Inputs

| Nom | Type | D√©faut | Description |
|-----|------|--------|-------------|
| `dsTooltip` | `string` | **Requis** | Texte affich√© dans le tooltip |
| `dsTooltipPosition` | `'top' \| 'bottom' \| 'left' \| 'right'` | `'top'` | Position du tooltip |
| `dsTooltipDelay` | `number` | `200` | D√©lai en ms avant affichage |

### Exemples

```html
<!-- Usage basique -->
<button dsTooltip="Cr√©er un nouvel √©l√©ment">Nouveau</button>

<!-- Avec position -->
<button dsTooltip="Position basse" dsTooltipPosition="bottom">Bottom</button>

<!-- Avec d√©lai personnalis√© -->
<button dsTooltip="Apparition lente" [dsTooltipDelay]="500">Hover me</button>

<!-- Sur un texte (terme technique) -->
<p>
  Survolez ce
  <span dsTooltip="Application Programming Interface" style="text-decoration: underline; cursor: help;">
    terme API
  </span>
  pour voir l'explication.
</p>

<!-- Sur des ic√¥nes (essentiel pour l'accessibilit√©) -->
<button dsTooltip="Ouvrir les param√®tres">‚öôÔ∏è</button>
<button dsTooltip="3 nouvelles notifications">üîî</button>

<!-- Bouton d√©sactiv√© (wrapper requis) -->
<span dsTooltip="Vous devez √™tre administrateur pour cette action">
  <button [disabled]="true">Action restreinte</button>
</span>

<!-- Toolbar avec raccourcis clavier -->
<button dsTooltip="Gras (Ctrl+B)">B</button>
<button dsTooltip="Italique (Ctrl+I)">I</button>
```

### Accessibilit√©

| Touche/Action | Comportement |
|---------------|--------------|
| Hover | Affiche le tooltip |
| Focus | Affiche le tooltip (√©l√©ments focusables) |
| Mouse leave | Masque le tooltip apr√®s d√©lai (150ms) |
| Blur | Masque le tooltip imm√©diatement |

| Attribut | Description |
|----------|-------------|
| `role="tooltip"` | Identifie le tooltip |
| `aria-describedby` | Lie l'√©l√©ment h√¥te au tooltip |

### Bonnes pratiques

1. **Texte court et informatif** - Le tooltip compl√®te, ne remplace pas
2. **Essentiel pour les boutons icon-only** - Accessibilit√© obligatoire
3. **D√©lai configurable** - √âviter de g√™ner la navigation
4. **Wrapper pour √©l√©ments d√©sactiv√©s** - Les √©l√©ments disabled ne re√ßoivent pas les events

### Stories disponibles

Default, Positions, DelayVariations, OnText, OnIcons, LongText, WithButtons, DisabledButton, FormHelp, Toolbar, Themed, Accessibility
