{/* FAQ.mdx */}
import { Meta } from '@storybook/blocks';

<Meta title="Guides/FAQ & Troubleshooting" />

# FAQ & Troubleshooting

Solutions aux probl√®mes courants rencontr√©s lors de l'utilisation de DS-Angular.

---

## Installation

### Les styles ne s'appliquent pas

**Probl√®me** : Les composants apparaissent sans style ou avec des styles cass√©s.

**Solutions** :

1. V√©rifiez l'import dans `src/styles.scss` :

```scss
// ‚úÖ Correct
@use '@kksdev/ds-angular/styles';

// ‚ùå Incorrect
@import '@kksdev/ds-angular/styles'; // Ancienne syntaxe
```

2. V√©rifiez que le fichier `angular.json` inclut les styles :

```json
{
  "styles": [
    "src/styles.scss"
  ]
}
```

3. Red√©marrez le serveur de d√©veloppement apr√®s modification.

---

### Erreur : "Cannot find module '@kksdev/ds-angular'"

**Probl√®me** : Le package n'est pas trouv√© apr√®s installation.

**Solutions** :

1. V√©rifiez l'installation :

```bash
npm list @kksdev/ds-angular
```

2. Si non install√©, ex√©cutez :

```bash
npm install @kksdev/ds-angular @angular/cdk @fortawesome/angular-fontawesome @fortawesome/free-solid-svg-icons
```

3. Supprimez `node_modules` et r√©installez :

```bash
rm -rf node_modules package-lock.json
npm install
```

---

### Erreur : "NullInjectorError: No provider for Overlay"

**Probl√®me** : Angular CDK Overlay n'est pas configur√©.

**Solution** :

Le package `@angular/cdk` doit √™tre install√©. Il est utilis√© par les composants overlay (modal, dropdown, tooltip, popover).

```bash
npm install @angular/cdk
```

---

## Th√®mes

### Le th√®me ne s'applique pas

**Probl√®me** : Les couleurs ne changent pas quand vous activez un th√®me.

**Solutions** :

1. V√©rifiez l'activation du th√®me :

```typescript
// Dans app.component.ts ou main.ts
document.documentElement.className = 'theme-light';
// ou
document.documentElement.className = 'theme-dark';
// ou
document.documentElement.className = 'theme-custom';
```

2. La classe doit √™tre sur `<html>`, pas sur `<body>` :

```html
<!-- ‚úÖ Correct -->
<html class="theme-dark">

<!-- ‚ùå Incorrect -->
<body class="theme-dark">
```

3. V√©rifiez qu'il n'y a pas de styles inline qui surchargent les tokens.

---

### Comment cr√©er un th√®me personnalis√© ?

**Solution** :

1. Cr√©ez un fichier `_custom-theme.scss` :

```scss
:root.theme-brand {
  // Couleurs principales
  --color-primary: #0066cc;
  --color-secondary: #004d99;

  // Backgrounds
  --background-main: #ffffff;
  --background-secondary: #f5f7fa;

  // Textes
  --text-default: #1a1a1a;
  --text-muted: #6b7280;

  // Bordures
  --border-color: #e5e7eb;

  // Composants sp√©cifiques
  --btn-primary-bg: var(--color-primary);
  --btn-primary-hover: var(--color-secondary);
}
```

2. Importez-le dans `styles.scss` :

```scss
@use '@kksdev/ds-angular/styles';
@use './custom-theme';
```

3. Activez-le :

```typescript
document.documentElement.className = 'theme-brand';
```

---

## Composants

### Les ic√¥nes ne s'affichent pas

**Probl√®me** : Les ic√¥nes FontAwesome dans les composants sont invisibles.

**Solutions** :

1. V√©rifiez l'installation :

```bash
npm install @fortawesome/angular-fontawesome @fortawesome/free-solid-svg-icons
```

2. Enregistrez les ic√¥nes n√©cessaires dans `app.config.ts` ou un module :

```typescript
import { FaIconLibrary } from '@fortawesome/angular-fontawesome';
import { faCheck, faTimes, faExclamationTriangle, faInfoCircle } from '@fortawesome/free-solid-svg-icons';

// Dans le constructeur ou ngOnInit
constructor(library: FaIconLibrary) {
  library.addIcons(faCheck, faTimes, faExclamationTriangle, faInfoCircle);
}
```

3. Ou utilisez le `IconRegistryService` de DS-Angular :

```typescript
import { IconRegistryService } from '@kksdev/ds-angular';

constructor(private iconRegistry: IconRegistryService) {
  this.iconRegistry.registerAll();
}
```

---

### Modal ne ferme pas avec ESC

**Probl√®me** : La touche Escape ne ferme pas la modal.

**Solutions** :

1. V√©rifiez que `closable` n'est pas √† `false` :

```html
<!-- ‚úÖ Fermeture ESC activ√©e -->
<ds-modal [open]="isOpen" [closable]="true">

<!-- ‚ùå ESC d√©sactiv√© -->
<ds-modal [open]="isOpen" [closable]="false">
```

2. Assurez-vous que le focus est dans la modal. Si le focus est en dehors, ESC ne fonctionnera pas.

3. V√©rifiez qu'aucun autre handler n'intercepte l'√©v√©nement keydown.

---

### Le formulaire ne se soumet pas

**Probl√®me** : Le bouton submit ne d√©clenche pas `ngSubmit`.

**Solutions** :

1. V√©rifiez que le bouton a `type="submit"` :

```html
<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <!-- ‚úÖ Correct -->
  <button ds-button type="submit">Envoyer</button>

  <!-- ‚ùå Incorrect (type="button" par d√©faut) -->
  <button ds-button>Envoyer</button>
</form>
```

2. V√©rifiez que le formulaire n'a pas d'erreurs de validation bloquantes.

---

### Select : l'option s√©lectionn√©e ne s'affiche pas

**Probl√®me** : Apr√®s s√©lection, le select reste vide.

**Solutions** :

1. V√©rifiez que la valeur correspond exactement √† une option :

```typescript
// ‚úÖ Correct : la valeur 'fr' existe dans les options
selectedValue = 'fr';
options = [
  { value: 'fr', label: 'France' },
  { value: 'de', label: 'Allemagne' }
];

// ‚ùå Incorrect : 'france' ne correspond √† aucune option
selectedValue = 'france';
```

2. Pour ngModel, assurez-vous du two-way binding :

```html
<ds-select [(ngModel)]="selectedValue" [options]="options" />
```

---

### Tooltip ne s'affiche pas

**Probl√®me** : Le tooltip n'appara√Æt pas au survol.

**Solutions** :

1. V√©rifiez la directive :

```html
<!-- ‚úÖ Correct -->
<button dsTooltip="Texte d'aide">Hover me</button>

<!-- ‚ùå Incorrect : attribut au lieu de directive -->
<button tooltip="Texte d'aide">Hover me</button>
```

2. V√©rifiez que l'√©l√©ment parent n'a pas `overflow: hidden` qui masque le tooltip.

3. V√©rifiez le z-index : le tooltip peut √™tre derri√®re d'autres √©l√©ments.

---

## Reactive Forms

### "formControlName" ne fonctionne pas

**Probl√®me** : Erreur "No value accessor for form control".

**Solutions** :

1. Importez `ReactiveFormsModule` :

```typescript
import { ReactiveFormsModule } from '@angular/forms';

@Component({
  standalone: true,
  imports: [ReactiveFormsModule, DsInputField, DsSelect]
})
```

2. Assurez-vous d'√™tre dans un `<form [formGroup]="...">` :

```html
<form [formGroup]="myForm">
  <ds-input-field formControlName="email" />
</form>
```

---

### Le FormControl ne se met pas √† jour

**Probl√®me** : La valeur du composant change mais le FormControl reste √† l'ancienne valeur.

**Solutions** :

1. V√©rifiez que vous utilisez `formControlName` et non `[value]` :

```html
<!-- ‚úÖ Correct -->
<ds-input-field formControlName="email" />

<!-- ‚ùå Incorrect : binding manuel ne propage pas au FormControl -->
<ds-input-field [value]="email" (valueChange)="email = $event" />
```

2. Pour ngModel, importez `FormsModule` :

```typescript
import { FormsModule } from '@angular/forms';

@Component({
  imports: [FormsModule, DsInputField]
})
```

---

## Performance

### L'application est lente avec beaucoup de composants

**Probl√®me** : Le rendu est lent quand il y a beaucoup de composants DS.

**Solutions** :

1. Utilisez `trackBy` dans les boucles :

```html
@for (item of items; track item.id) {
  <ds-card>{{ item.name }}</ds-card>
}
```

2. Utilisez `OnPush` change detection :

```typescript
@Component({
  changeDetection: ChangeDetectionStrategy.OnPush
})
```

3. Lazy-load les composants rarement utilis√©s.

---

### Le bundle est trop gros

**Probl√®me** : La taille du bundle final est importante.

**Solutions** :

1. Importez uniquement les composants n√©cessaires :

```typescript
// ‚úÖ Bon : imports s√©lectifs
import { DsButton, DsInputField } from '@kksdev/ds-angular';

// ‚ùå √Ä √©viter : import global (si disponible)
import * as DS from '@kksdev/ds-angular';
```

2. V√©rifiez le tree-shaking avec :

```bash
npm run build -- --stats-json
npx webpack-bundle-analyzer dist/your-app/stats.json
```

3. DS-Angular est configur√© avec `sideEffects: false` pour un tree-shaking optimal.

---

## Accessibilit√©

### Le focus n'est pas visible

**Probl√®me** : L'indicateur de focus clavier n'appara√Æt pas.

**Solutions** :

1. Ne supprimez pas le outline par d√©faut :

```scss
// ‚ùå √Ä √©viter
* {
  outline: none !important;
}

// ‚úÖ DS-Angular g√®re le focus automatiquement
```

2. Les composants utilisent `:focus-visible` pour n'afficher le focus que lors de la navigation clavier.

---

### Les lecteurs d'√©cran n'annoncent pas les erreurs

**Probl√®me** : Les messages d'erreur ne sont pas lus automatiquement.

**Solution** :

Utilisez la prop `errorText` plut√¥t qu'un √©l√©ment externe :

```html
<!-- ‚úÖ Correct : annonc√© automatiquement -->
<ds-input-field
  [state]="hasError ? 'error' : 'default'"
  [errorText]="hasError ? 'Email invalide' : ''"
/>

<!-- ‚ùå Incorrect : non associ√© au champ -->
<ds-input-field [state]="hasError ? 'error' : 'default'" />
<span class="error">Email invalide</span>
```

---

## Support

### O√π signaler un bug ?

Ouvrez une issue sur GitHub avec :
- Version de DS-Angular
- Version d'Angular
- Description du probl√®me
- Code minimal pour reproduire
- Screenshots si pertinent

### O√π poser des questions ?

- **GitHub Discussions** : Questions g√©n√©rales
- **Stack Overflow** : Tag `ds-angular`

---

<div style={{
  padding: '24px',
  background: 'var(--info)',
  color: 'white',
  borderRadius: '12px',
  textAlign: 'center',
  marginTop: '32px'
}}>
  <div style={{ fontSize: '24px', marginBottom: '8px' }}>üí°</div>
  <strong>Vous ne trouvez pas votre r√©ponse ?</strong>
  <p style={{ margin: '8px 0 0', fontSize: '14px', opacity: 0.9 }}>
    Consultez la documentation des composants ou ouvrez une issue sur GitHub.
  </p>
</div>
