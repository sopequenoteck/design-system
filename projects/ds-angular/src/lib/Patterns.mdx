{/* Patterns.mdx */}
import { Meta } from '@storybook/blocks';

<Meta title="Patterns" />

# Patterns de composition

Ce guide documente les patterns de composition courants pour faciliter l'utilisation combinée des composants du design system.

---

## 1. Formulaire complet (input + checkbox + button)

Pattern classique de formulaire avec validation, champs multiples et soumission.

```typescript
// src/app/signup/signup.component.ts
import { Component, signal } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { DsInputField, DsCheckbox, DsButton } from 'ds-angular';
import { faUser, faEnvelope, faLock } from '@fortawesome/free-solid-svg-icons';

@Component({
  selector: 'app-signup',
  standalone: true,
  imports: [FormsModule, DsInputField, DsCheckbox, DsButton],
  template: `
    <form (ngSubmit)="handleSubmit()" class="signup-form">
      <h2>Créer un compte</h2>

      <!-- Nom d'utilisateur -->
      <ds-input-field
        name="username"
        label="Nom d'utilisateur"
        placeholder="Choisissez un nom d'utilisateur"
        [iconStart]="userIcon"
        [(ngModel)]="username"
        [error]="usernameError()"
        required>
      </ds-input-field>

      <!-- Email -->
      <ds-input-field
        name="email"
        type="email"
        label="Adresse email"
        placeholder="exemple@domaine.com"
        [iconStart]="emailIcon"
        [(ngModel)]="email"
        [error]="emailError()"
        required>
      </ds-input-field>

      <!-- Mot de passe -->
      <ds-input-field
        name="password"
        type="password"
        label="Mot de passe"
        [togglePassword]="true"
        [iconStart]="lockIcon"
        [(ngModel)]="password"
        [error]="passwordError()"
        helper="Minimum 8 caractères"
        required>
      </ds-input-field>

      <!-- Conditions d'utilisation -->
      <ds-checkbox
        name="terms"
        label="J'accepte les conditions d'utilisation"
        [(checked)]="acceptTerms"
        [error]="termsError()">
      </ds-checkbox>

      <!-- Bouton de soumission -->
      <ds-button
        variant="primary"
        submit
        block
        [loading]="isSubmitting()"
        [disabled]="!isFormValid()">
        Créer mon compte
      </ds-button>
    </form>
  `,
  styles: [`
    .signup-form {
      max-width: 400px;
      margin: 0 auto;
      padding: var(--space-6);
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }
  `]
})
export class SignupComponent {
  username = signal('');
  email = signal('');
  password = signal('');
  acceptTerms = signal(false);
  isSubmitting = signal(false);

  userIcon = faUser;
  emailIcon = faEnvelope;
  lockIcon = faLock;

  usernameError() {
    const value = this.username();
    if (!value) return 'Nom d'utilisateur requis';
    if (value.length < 3) return 'Minimum 3 caractères';
    return '';
  }

  emailError() {
    const value = this.email();
    if (!value) return 'Email requis';
    if (!value.includes('@')) return 'Email invalide';
    return '';
  }

  passwordError() {
    const value = this.password();
    if (!value) return 'Mot de passe requis';
    if (value.length < 8) return 'Minimum 8 caractères';
    return '';
  }

  termsError() {
    return this.acceptTerms() ? '' : 'Vous devez accepter les conditions';
  }

  isFormValid() {
    return !this.usernameError() &&
           !this.emailError() &&
           !this.passwordError() &&
           this.acceptTerms();
  }

  handleSubmit() {
    if (!this.isFormValid()) return;

    this.isSubmitting.set(true);
    // Simulation appel API
    setTimeout(() => {
      console.log('Compte créé:', {
        username: this.username(),
        email: this.email()
      });
      this.isSubmitting.set(false);
    }, 2000);
  }
}
```

---

## 2. Modal avec formulaire

Pattern de modal contenant un formulaire de confirmation ou d'édition.

```typescript
// src/app/edit-profile/edit-profile.component.ts
import { Component, signal, viewChild } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { DsModal, DsInputField, DsButton, DsInputTextarea } from 'ds-angular';

@Component({
  selector: 'app-edit-profile',
  standalone: true,
  imports: [FormsModule, DsModal, DsInputField, DsInputTextarea, DsButton],
  template: `
    <ds-button variant="primary" (clicked)="openModal()">
      Éditer le profil
    </ds-button>

    <ds-modal
      title="Modifier votre profil"
      size="md"
      [closable]="true"
      [closeOnBackdrop]="false"
      (closed)="handleModalClose()">

      <form (ngSubmit)="handleSave()" class="profile-form">
        <ds-input-field
          name="displayName"
          label="Nom d'affichage"
          [(ngModel)]="displayName"
          required>
        </ds-input-field>

        <ds-input-textarea
          name="bio"
          label="Biographie"
          placeholder="Parlez-nous de vous..."
          [rows]="4"
          [maxlength]="200"
          [(ngModel)]="bio">
        </ds-input-textarea>

        <ds-input-field
          name="location"
          label="Localisation"
          placeholder="Ville, Pays"
          [(ngModel)]="location">
        </ds-input-field>

        <div class="modal-actions">
          <ds-button
            variant="ghost"
            (clicked)="closeModal()">
            Annuler
          </ds-button>
          <ds-button
            variant="primary"
            submit
            [loading]="isSaving()">
            Enregistrer
          </ds-button>
        </div>
      </form>
    </ds-modal>
  `,
  styles: [`
    .profile-form {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }
    .modal-actions {
      display: flex;
      gap: var(--space-3);
      justify-content: flex-end;
      margin-top: var(--space-4);
    }
  `]
})
export class EditProfileComponent {
  modal = viewChild.required(DsModal);

  displayName = signal('John Doe');
  bio = signal('');
  location = signal('');
  isSaving = signal(false);

  openModal() {
    this.modal().open();
  }

  closeModal() {
    this.modal().close();
  }

  handleModalClose() {
    console.log('Modal fermée');
  }

  handleSave() {
    this.isSaving.set(true);
    // Simulation sauvegarde
    setTimeout(() => {
      console.log('Profil sauvegardé:', {
        displayName: this.displayName(),
        bio: this.bio(),
        location: this.location()
      });
      this.isSaving.set(false);
      this.closeModal();
    }, 1500);
  }
}
```

---

## 3. Dropdown dans toolbar

Pattern de barre d'outils avec actions via dropdown.

```typescript
// src/app/toolbar/toolbar.component.ts
import { Component } from '@angular/core';
import { DsDropdown, DsButton, DsBadge } from 'ds-angular';
import { faEllipsisV, faEdit, faTrash, faShare, faDownload } from '@fortawesome/free-solid-svg-icons';

@Component({
  selector: 'app-toolbar',
  standalone: true,
  imports: [DsDropdown, DsButton, DsBadge],
  template: `
    <div class="toolbar">
      <div class="toolbar-left">
        <h3>Mon Document</h3>
        <ds-badge variant="info" size="sm">Brouillon</ds-badge>
      </div>

      <div class="toolbar-right">
        <ds-button variant="primary" size="sm">
          Enregistrer
        </ds-button>

        <ds-dropdown
          [items]="menuItems"
          position="bottom-end"
          (itemSelected)="handleAction($event)">
          <ds-button
            variant="ghost"
            size="sm"
            [iconStart]="menuIcon"
            dropdownTrigger>
          </ds-button>
        </ds-dropdown>
      </div>
    </div>
  `,
  styles: [`
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-3) var(--space-4);
      background: var(--background-secondary);
      border-bottom: 1px solid var(--border-default);
    }
    .toolbar-left {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    .toolbar-right {
      display: flex;
      gap: var(--space-2);
    }
  `]
})
export class ToolbarComponent {
  menuIcon = faEllipsisV;

  menuItems = [
    { id: 'edit', label: 'Éditer', icon: faEdit },
    { id: 'share', label: 'Partager', icon: faShare },
    { id: 'download', label: 'Télécharger', icon: faDownload },
    { id: 'separator', label: '', disabled: true },
    { id: 'delete', label: 'Supprimer', icon: faTrash }
  ];

  handleAction(item: any) {
    console.log('Action sélectionnée:', item.id);

    switch (item.id) {
      case 'edit':
        // Logique d'édition
        break;
      case 'share':
        // Logique de partage
        break;
      case 'download':
        // Logique de téléchargement
        break;
      case 'delete':
        // Logique de suppression
        break;
    }
  }
}
```

---

## 4. Toast notifications système

Pattern de notifications système avec différents types et gestion de la pile.

```typescript
// src/app/notifications/notifications.component.ts
import { Component, inject } from '@angular/core';
import { DsButton, DsToastService } from 'ds-angular';

@Component({
  selector: 'app-notifications',
  standalone: true,
  imports: [DsButton],
  template: `
    <div class="notification-demo">
      <h2>Système de notifications</h2>

      <div class="actions">
        <ds-button
          variant="success"
          (clicked)="showSuccess()">
          Succès
        </ds-button>

        <ds-button
          variant="warning"
          (clicked)="showWarning()">
          Avertissement
        </ds-button>

        <ds-button
          variant="error"
          (clicked)="showError()">
          Erreur
        </ds-button>

        <ds-button
          variant="info"
          (clicked)="showInfo()">
          Information
        </ds-button>

        <ds-button
          variant="ghost"
          (clicked)="showMultiple()">
          Notifications multiples
        </ds-button>
      </div>
    </div>
  `,
  styles: [`
    .notification-demo {
      padding: var(--space-6);
    }
    .actions {
      display: flex;
      gap: var(--space-3);
      flex-wrap: wrap;
      margin-top: var(--space-4);
    }
  `]
})
export class NotificationsComponent {
  private toastService = inject(DsToastService);

  showSuccess() {
    this.toastService.success('Opération réussie', 'Vos modifications ont été enregistrées');
  }

  showWarning() {
    this.toastService.warning('Attention requise', 'Certains champs nécessitent votre attention');
  }

  showError() {
    this.toastService.error('Erreur', 'Impossible de se connecter au serveur');
  }

  showInfo() {
    this.toastService.info('Information', 'Une mise à jour est disponible');
  }

  showMultiple() {
    this.toastService.success('Premier message', 'Opération 1/3');
    setTimeout(() => {
      this.toastService.info('Deuxième message', 'Opération 2/3');
    }, 500);
    setTimeout(() => {
      this.toastService.success('Terminé', 'Toutes les opérations sont complétées');
    }, 1000);
  }
}
```

**Bonnes pratiques pour les toasts** :

- Limiter la durée d'affichage (3-5 secondes pour success/info, 7-10 secondes pour warning/error)
- Éviter plus de 3 toasts simultanés
- Utiliser des messages courts et actionables
- Positionner en top-right pour ne pas bloquer le contenu principal
- Permettre la fermeture manuelle pour les messages importants

---

## 5. Carte avec Alert

Pattern de carte enrichie avec bannière d'alerte contextuelle.

```typescript
// src/app/account-card/account-card.component.ts
import { Component, signal } from '@angular/core';
import { DsCard, DsAlert, DsButton, DsBadge } from 'ds-angular';

@Component({
  selector: 'app-account-card',
  standalone: true,
  imports: [DsCard, DsAlert, DsButton, DsBadge],
  template: `
    <ds-card variant="elevated" size="lg">
      <!-- Alert intégrée en haut de la carte -->
      <ds-alert
        type="warning"
        [closable]="true"
        (closed)="handleAlertClose()"
        *ngIf="showAlert()">
        Votre abonnement expire dans 7 jours. Renouvelez-le maintenant pour éviter toute interruption.
      </ds-alert>

      <!-- En-tête de carte -->
      <div class="card-header">
        <div>
          <h3>Compte Premium</h3>
          <ds-badge variant="success" size="md">Actif</ds-badge>
        </div>
        <p class="expiry">Expire le 15/12/2025</p>
      </div>

      <!-- Contenu principal -->
      <div class="card-body">
        <dl class="details-list">
          <div class="detail-item">
            <dt>Stockage utilisé</dt>
            <dd>45 GB / 100 GB</dd>
          </div>
          <div class="detail-item">
            <dt>Utilisateurs actifs</dt>
            <dd>3 / 5</dd>
          </div>
          <div class="detail-item">
            <dt>Projets</dt>
            <dd>12</dd>
          </div>
        </dl>
      </div>

      <!-- Actions -->
      <div class="card-footer">
        <ds-button variant="outline" size="md">
          Voir les détails
        </ds-button>
        <ds-button variant="primary" size="md">
          Renouveler maintenant
        </ds-button>
      </div>
    </ds-card>
  `,
  styles: [`
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--space-4);
      padding-bottom: var(--space-4);
      border-bottom: 1px solid var(--border-subtle);
    }
    .card-header > div {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    .expiry {
      color: var(--text-muted);
      font-size: var(--font-size-sm);
    }
    .card-body {
      margin: var(--space-4) 0;
    }
    .details-list {
      display: grid;
      gap: var(--space-3);
    }
    .detail-item {
      display: flex;
      justify-content: space-between;
      padding: var(--space-2) 0;
    }
    .detail-item dt {
      color: var(--text-muted);
      font-weight: normal;
    }
    .detail-item dd {
      font-weight: 600;
      margin: 0;
    }
    .card-footer {
      display: flex;
      gap: var(--space-3);
      justify-content: flex-end;
      padding-top: var(--space-4);
      border-top: 1px solid var(--border-subtle);
    }
  `]
})
export class AccountCardComponent {
  showAlert = signal(true);

  handleAlertClose() {
    this.showAlert.set(false);
  }
}
```

**Variantes utiles** :

- **Carte avec alerte succès** : Pour confirmer une action récente
- **Carte avec alerte erreur** : Pour signaler un problème nécessitant attention
- **Carte avec alerte info** : Pour afficher des informations contextuelles

---

## 6. Divider dans liste

Pattern d'utilisation du divider pour séparer visuellement des groupes d'éléments.

```typescript
// src/app/settings-list/settings-list.component.ts
import { Component } from '@angular/core';
import { DsDivider, DsToggle } from 'ds-angular';
import { faUser, faBell, faLock, faGlobe, faPalette } from '@fortawesome/free-solid-svg-icons';

@Component({
  selector: 'app-settings-list',
  standalone: true,
  imports: [DsDivider, DsToggle],
  template: `
    <div class="settings-container">
      <h2>Paramètres</h2>

      <!-- Section Compte -->
      <div class="settings-section">
        <div class="setting-item">
          <fa-icon [icon]="userIcon" class="icon"></fa-icon>
          <div class="setting-content">
            <h4>Profil public</h4>
            <p>Rendre votre profil visible par tous les utilisateurs</p>
          </div>
          <ds-toggle [checked]="true"></ds-toggle>
        </div>

        <div class="setting-item">
          <fa-icon [icon]="bellIcon" class="icon"></fa-icon>
          <div class="setting-content">
            <h4>Notifications par email</h4>
            <p>Recevoir des alertes par email</p>
          </div>
          <ds-toggle [checked]="false"></ds-toggle>
        </div>
      </div>

      <!-- Divider avec label -->
      <ds-divider
        [withLabel]="true"
        labelPosition="left"
        spacing="lg">
        Sécurité
      </ds-divider>

      <!-- Section Sécurité -->
      <div class="settings-section">
        <div class="setting-item">
          <fa-icon [icon]="lockIcon" class="icon"></fa-icon>
          <div class="setting-content">
            <h4>Authentification à deux facteurs</h4>
            <p>Ajouter une couche de sécurité supplémentaire</p>
          </div>
          <ds-toggle [checked]="true"></ds-toggle>
        </div>
      </div>

      <!-- Divider simple -->
      <ds-divider variant="dashed" spacing="lg"></ds-divider>

      <!-- Section Apparence -->
      <div class="settings-section">
        <div class="setting-item">
          <fa-icon [icon]="globeIcon" class="icon"></fa-icon>
          <div class="setting-content">
            <h4>Langue</h4>
            <p>Français</p>
          </div>
        </div>

        <div class="setting-item">
          <fa-icon [icon]="paletteIcon" class="icon"></fa-icon>
          <div class="setting-content">
            <h4>Thème</h4>
            <p>Mode sombre</p>
          </div>
          <ds-toggle [checked]="true"></ds-toggle>
        </div>
      </div>
    </div>
  `,
  styles: [`
    .settings-container {
      max-width: 600px;
      margin: 0 auto;
      padding: var(--space-6);
    }
    .settings-section {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }
    .setting-item {
      display: flex;
      align-items: flex-start;
      gap: var(--space-4);
      padding: var(--space-3);
      border-radius: var(--radius-2);
      transition: background-color 0.2s;
    }
    .setting-item:hover {
      background-color: var(--background-hover);
    }
    .icon {
      color: var(--text-muted);
      font-size: 1.25rem;
      margin-top: 0.125rem;
      flex-shrink: 0;
    }
    .setting-content {
      flex: 1;
    }
    .setting-content h4 {
      margin: 0 0 var(--space-1) 0;
      font-size: var(--font-size-base);
      font-weight: 600;
    }
    .setting-content p {
      margin: 0;
      color: var(--text-muted);
      font-size: var(--font-size-sm);
    }
  `]
})
export class SettingsListComponent {
  userIcon = faUser;
  bellIcon = faBell;
  lockIcon = faLock;
  globeIcon = faGlobe;
  paletteIcon = faPalette;
}
```

**Variantes de divider** :

- **`variant="solid"`** (par défaut) : Ligne continue pour séparations fortes
- **`variant="dashed"`** : Ligne pointillée pour séparations visuelles légères
- **`variant="dotted"`** : Séparation très subtile
- **`spacing`** : Contrôle l'espacement vertical (`none`, `sm`, `md`, `lg`)
- **`withLabel`** : Ajoute un label au divider pour nommer les sections

---

## Ressources complémentaires

- [Introduction](./Introduction) — Installation et Quick Start
- [Integration](./Integration) — Exemples d'intégration Angular avancés
- [Contributing](./Contributing) — Guide de contribution
